@using Barbershop.ViewModels
@model AppointmentCreateModel

@{
    ViewData["Title"] = "Book Appointment";
}

<h2>Book Appointment</h2>

<form asp-action="Book" method="post">
    <input type="hidden" name="ServiceId" value="@Model.ServiceId" />

    <div class="form-group">
        <label for="AppointmentDate">Select Date</label>
        <input type="date" id="AppointmentDate" name="AppointmentDate" class="form-control" />
    </div>

    <div class="form-group">
        <label for="Time">Select Time</label>
        <select id="Time" name="Time" class="form-control"></select>
    </div>

    <input type="hidden" name="UserId" value="@User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value" />

    <div class="mt-3">
        <button type="submit" class="btn btn-primary">Запази</button>
    </div>
</form>

@section Scripts {
    <script>
        function loadSlots() {
            const date = document.getElementById("AppointmentDate").value;
            const serviceId = "@Model.ServiceId";

            if (!date || !serviceId) return;

            fetch(`/Appointment/GetAvailableSlots?date=${date}&serviceId=${serviceId}`)
                .then(res => res.json())
                .then(data => {
                    const select = document.getElementById("Time");
                    select.innerHTML = '';
                    data.forEach(t => {
                        const option = document.createElement("option");
                        option.value = t;
                        option.text = t;
                        select.appendChild(option);
                    });
                });
        }

        document.getElementById("AppointmentDate").addEventListener("change", loadSlots);
    </script>
}